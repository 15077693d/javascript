#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

const ENV_LOCAL_FILEPATH = path.join(process.cwd(), '.env.local');

(async function () {
  try {
    const res = await fetch('https://api.clerkstage.dev/v1/public/demo_instance', {
      method: 'POST',
    });

    const { frontend_api_key, backend_api_key } = await res.json();

    let clerkEnvVars = `
# Clerk autogenerated environment variables
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${frontend_api_key}
CLERK_SECRET_KEY=${backend_api_key}`;

    fs.appendFileSync(ENV_LOCAL_FILEPATH, clerkEnvVars);
  } catch (error) {
    // TODO: Add proper error handling
    console.error('Clerk: Failed to generate a demo instance', error.message || error.stack);
  }
})();
